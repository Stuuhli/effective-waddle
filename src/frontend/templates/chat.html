{% extends "base.html" %}

{% block title %}RAG Platform â€“ Chat{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('frontend_static', path='chat.css') }}" />
{% endblock %}

{% block body %}
    <div class="chat-layout chat-layout--sidebar-open" id="chat-layout">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar__header">
          <h2>Conversations</h2>
          <button class="sidebar__icon-button" id="sidebar-close" type="button" aria-label="Close sidebar">
            <span class="icon icon--close"></span>
          </button>
        </div>
        <nav class="sidebar__section">
          <div class="sidebar__section-header">
            <h3>Recent</h3>
            <button class="sidebar__link sidebar__link--ghost" id="new-conversation" type="button">
              <span class="icon icon--plus"></span>
              New conversation
            </button>
          </div>
          <ul class="conversation-list" id="conversation-list">
            {% if conversations %}
              {% for convo in conversations %}
                <li class="conversation-list__item">
                  <button class="conversation-list__button" type="button" data-id="{{ convo.id }}">
                    <span class="conversation-list__title">{{ convo.title }}</span>
                    <span class="conversation-list__meta">{{ convo.updated_at }}</span>
                  </button>
                </li>
              {% endfor %}
            {% else %}
              <li class="conversation-list__empty">No conversations yet. Create your first one to begin.</li>
            {% endif %}
          </ul>
        </nav>
        <nav class="sidebar__section sidebar__section--admin" id="admin-links" aria-label="Admin tools">
          <h3>Admin tools</h3>
          <a class="sidebar__link" href="/frontend/ingestion">Ingestion Console</a>
          <a class="sidebar__link" href="/frontend/admin">User Management</a>
        </nav>
      </aside>

      <div class="main">
        <header class="main__header">
          <button class="sidebar-toggle" id="sidebar-open" type="button" aria-label="Toggle sidebar">
            <span class="icon icon--menu"><span class="icon__line"></span></span>
          </button>
          <div class="main__title">
            <h1>Chat Console</h1>
            <p>Stream responses from your LLM, manage conversations, and jump into admin tools.</p>
          </div>
          <div class="status-pill status-pill--idle" id="stream-status" role="status" aria-live="polite">
            Idle
          </div>
        </header>

        <section class="chat-window" id="chat-window" aria-live="polite">
          <div class="message message--system">
            <span class="message__author">System</span>
            <p class="message__content">
              Select an existing conversation or start a new one to begin streaming responses. Messages will appear here.
            </p>
          </div>
        </section>

        <form class="composer" id="chat-form" autocomplete="off">
          <label class="composer__label" for="chat-input">Ask the model</label>
          <textarea
            class="composer__input"
            id="chat-input"
            name="message"
            rows="3"
            placeholder="Compose your question or instruction..."
            required
          ></textarea>
          <div class="composer__actions">
            <button class="button button--primary" type="submit" id="send-button">
              <span class="icon icon--send"></span>
              Send & Stream
            </button>
            <button class="button button--ghost" type="button" id="stop-stream" disabled>
              <span class="icon icon--stop"></span>
              Stop streaming
            </button>
          </div>
        </form>
      </div>
    </div>
{% endblock %}

{% block scripts %}
    <script defer src="{{ url_for('frontend_static', path='chat.js') }}"></script>
{% endblock %}
