{% extends "base.html" %}

{% block title %}RAG Platform â€“ Chat{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('frontend_static', path='chat.css') }}" />
{% endblock %}

{% block body %}
    <div class="chat-layout smoke-panel chat-layout--sidebar-open" id="chat-layout">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar__header">
          <h2>Conversations</h2>
        </div>
        <nav class="sidebar__section">
          <div class="sidebar__section-header">
            <h3>Recent</h3>
            <button class="sidebar__link sidebar__link--ghost" id="new-conversation" type="button">
              <span class="icon icon--plus"></span>
              New conversation
            </button>
          </div>
          <ul class="conversation-list" id="conversation-list">
            {% if conversations %}
              {% for convo in conversations %}
                <li class="conversation-list__item">
                  <button
                    class="conversation-list__button"
                    type="button"
                    data-id="{{ convo.id }}"
                    data-title="{{ convo.title or '' }}"
                  >
                    <span class="conversation-list__title">{{ convo.title or 'New session' }}</span>
                    <span class="conversation-list__meta">
                      {{ convo.updated_at.strftime("%Y-%m-%d %H:%M") if convo.updated_at else '' }}
                    </span>
                  </button>
                </li>
              {% endfor %}
            {% else %}
              <li class="conversation-list__empty">No conversations yet. Create your first one to begin.</li>
            {% endif %}
          </ul>
        </nav>
        <nav class="sidebar__section sidebar__section--admin" id="admin-links" aria-label="Admin tools">
          <h3>Admin tools</h3>
          <a class="sidebar__link" href="/frontend/ingestion">Ingestion Console</a>
          <a class="sidebar__link" href="/frontend/admin">Admin Console</a>
        </nav>
      </aside>

      <div class="main">
        <header class="main__header">
          <button class="sidebar-toggle" id="sidebar-open" type="button" aria-label="Toggle sidebar" aria-pressed="true">
            <span id="sidebar-toggle-icon" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="24" height="24" fill="#eeeeef"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>
            </span>
          </button>
          <div class="main__title">
            <h1>Chat Console</h1>
            <p>Ask KiRa about anything, manage conversations, or jump into admin tools.</p>
          </div>
          <div class="main__header-actions">
            <button class="icon-button fullscreen-toggle" id="fullscreen-toggle" type="button" aria-label="Enter fullscreen" aria-pressed="false">
              <span class="fullscreen-toggle__icon fullscreen-toggle__icon--enter" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="20" height="20" fill="#eeeeef"><path d="M120-120v-200h80v120h120v80H120Zm520 0v-80h120v-120h80v200H640ZM120-640v-200h200v80H200v120h-80Zm640 0v-120H640v-80h200v200h-80Z"/></svg>
              </span>
              <span class="fullscreen-toggle__icon fullscreen-toggle__icon--exit" aria-hidden="true" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="20" height="20" fill="#eeeeef"><path d="M240-120v-120H120v-80h200v200h-80Zm400 0v-200h200v80H720v120h-80ZM120-640v-80h120v-120h80v200H120Zm520 0v-200h80v120h120v80H640Z"/></svg>
              </span>
            </button>
            <div class="status-pill status-pill--idle" id="stream-status" role="status" aria-live="polite">
              Idle
            </div>
          </div>
        </header>

        <section class="chat-window" id="chat-window" aria-live="polite">
          <div class="message message--system">
            <span class="message__author">System</span>
            <p class="message__content">
              Select an existing conversation or start a new one to begin streaming responses. Messages will appear here.
            </p>
          </div>
        </section>

        <form class="composer" id="chat-form" autocomplete="off">
          <label class="composer__label" for="chat-input">Ask the model</label>
          <textarea
            class="composer__input"
            id="chat-input"
            name="message"
            rows="3"
            placeholder="What would you like to ask KiRa?"
            required
          ></textarea>
          <div class="composer__actions">
            <button class="button button--ghost" type="button" id="stop-stream" disabled>
              <span class="icon icon--stop"></span>
              Stop streaming
            </button>
            <button class="button button--primary" type="submit" id="send-button">
              <span class="icon icon--send"></span>
              Send & Stream
            </button>
          </div>
        </form>
      </div>
    </div>
{% endblock %}

{% block scripts %}
    <script defer src="{{ url_for('frontend_static', path='chat.js') }}"></script>
{% endblock %}
